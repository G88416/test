<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Comprehensive HRMS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #f4f7fa; color: #333; }
        .sidebar { background-color: #ffffff; border-right: 1px solid #dee2e6; height: 100vh; position: fixed; width: 250px; padding: 20px; overflow-y: auto; transition: width 0.3s ease; z-index: 1000; }
        .sidebar.collapsed { width: 60px; }
        .sidebar.collapsed .nav-text { display: none; }
        .sidebar .nav-link { color: #495057; font-weight: 500; margin-bottom: 10px; padding: 10px; transition: all 0.2s; }
        .sidebar .nav-link:hover { color: #0d6efd; background-color: #f8f9fa; border-radius: 5px; }
        .sidebar .nav-link.active { color: #0d6efd; background-color: #e7f1ff; border-radius: 5px; }
        .content { margin-left: 250px; padding: 40px; transition: margin-left 0.3s ease; }
        .content.expanded { margin-left: 60px; }
        .card-metric { background-color: #ffffff; border: none; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-radius: 10px; transition: transform 0.2s; }
        .card-metric:hover { transform: translateY(-5px); }
        .table { background-color: #ffffff; box-shadow: 0 2px 10px rgba(0,0,0,0.05); border-radius: 10px; overflow: hidden; }
        .modal-content { border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.2); }
        #dashboardChart { max-height: 400px; }
        .section { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .search-input { max-width: 300px; }
        .btn-toggle-sidebar { position: fixed; top: 20px; left: 260px; z-index: 1001; transition: left 0.3s ease; }
        .btn-toggle-sidebar.expanded { left: 70px; }
        @media (max-width: 768px) {
            .sidebar { width: 60px; }
            .content { margin-left: 60px; }
            .btn-toggle-sidebar { left: 70px; }
            .sidebar .nav-text { display: none; }
        }

        /* Dark Mode Styles */
        .dark-mode { background-color: #121212; color: #e0e0e0; }
        .dark-mode .sidebar { background-color: #1e1e1e; border-right: 1px solid #333; }
        .dark-mode .nav-link { color: #bbb; }
        .dark-mode .nav-link:hover { color: #fff; background-color: #333; }
        .dark-mode .nav-link.active { color: #0d6efd; background-color: #333; }
        .dark-mode .content { background-color: #121212; }
        .dark-mode .card-metric { background-color: #1e1e1e; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .dark-mode .table { background-color: #1e1e1e; color: #e0e0e0; }
        .dark-mode .table-striped tbody tr:nth-of-type(odd) { background-color: #252525; }
        .dark-mode .table thead th { background-color: #333; }
        .dark-mode .modal-content { background-color: #1e1e1e; color: #e0e0e0; }
        .dark-mode .form-control { background-color: #333; color: #e0e0e0; border: 1px solid #555; }
        .dark-mode .form-control:focus { background-color: #333; color: #e0e0e0; border-color: #0d6efd; box-shadow: 0 0 0 0.25rem rgba(13,110,253,.25); }
        .dark-mode .btn-primary { background-color: #0d6efd; border-color: #0d6efd; }
        .dark-mode .btn-primary:hover { background-color: #0b5ed7; border-color: #0a58ca; }
    </style>
</head>
<body>
    <button class="btn btn-sm btn-primary btn-toggle-sidebar" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
    <div class="sidebar">
        <h4 class="mb-4"><i class="fas fa-users me-2"></i><span class="nav-text">HRMS System</span></h4>
        <ul class="nav flex-column">
            <li><a href="#dashboard" class="nav-link active" onclick="showSection('dashboard')"><i class="fas fa-tachometer-alt me-2"></i><span class="nav-text">Dashboard</span></a></li>
            <li><a href="#employees" class="nav-link" onclick="showSection('employees')"><i class="fas fa-user-friends me-2"></i><span class="nav-text">Employees</span></a></li>
            <li><a href="#payroll" class="nav-link" onclick="showSection('payroll')"><i class="fas fa-money-check-alt me-2"></i><span class="nav-text">Payroll</span></a></li>
            <li><a href="#recruitment" class="nav-link" onclick="showSection('recruitment')"><i class="fas fa-briefcase me-2"></i><span class="nav-text">Recruitment</span></a></li>
            <li><a href="#performance" class="nav-link" onclick="showSection('performance')"><i class="fas fa-chart-line me-2"></i><span class="nav-text">Performance</span></a></li>
            <li><a href="#attendance" class="nav-link" onclick="showSection('attendance')"><i class="fas fa-clock me-2"></i><span class="nav-text">Attendance</span></a></li>
            <li><a href="#leaves" class="nav-link" onclick="showSection('leaves')"><i class="fas fa-calendar-alt me-2"></i><span class="nav-text">Leaves</span></a></li>
            <li><a href="#benefits" class="nav-link" onclick="showSection('benefits')"><i class="fas fa-gift me-2"></i><span class="nav-text">Benefits</span></a></li>
            <li><a href="#training" class="nav-link" onclick="showSection('training')"><i class="fas fa-graduation-cap me-2"></i><span class="nav-text">Training</span></a></li>
            <li><a href="#reports" class="nav-link" onclick="showSection('reports')"><i class="fas fa-file-alt me-2"></i><span class="nav-text">Reports</span></a></li>
            <li><a href="#settings" class="nav-link" onclick="showSection('settings')"><i class="fas fa-cog me-2"></i><span class="nav-text">Settings</span></a></li>
            <li><a href="#" class="nav-link text-danger" onclick="logout()"><i class="fas fa-sign-out-alt me-2"></i><span class="nav-text">Logout</span></a></li>
        </ul>
    </div>

    <div class="content">
        <!-- Dashboard Section -->
        <section id="dashboard" class="section active">
            <h2>Dashboard Overview</h2>
            <div class="row mt-4">
                <div class="col-md-3"><div class="card card-metric p-3"><h5>Total Employees</h5><h3 id="totalEmployees">0</h3></div></div>
                <div class="col-md-3"><div class="card card-metric p-3"><h5>Open Positions</h5><h3 id="openPositions">0</h3></div></div>
                <div class="col-md-3"><div class="card card-metric p-3"><h5>Average Performance</h5><h3 id="avgPerformance">0/5</h3></div></div>
                <div class="col-md-3"><div class="card card-metric p-3"><h5>Pending Leaves</h5><h3 id="pendingLeaves">0</h3></div></div>
            </div>
            <div class="mt-4">
                <canvas id="dashboardChart"></canvas>
            </div>
        </section>

        <!-- Employees Section -->
        <section id="employees" class="section d-none">
            <h2>Employee Management</h2>
            <div class="d-flex justify-content-between mb-3">
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addEmployeeModal">Add Employee</button>
                <input type="text" class="form-control search-input" id="employeeSearch" placeholder="Search Employees..." oninput="searchEmployees()">
            </div>
            <table class="table table-striped">
                <thead><tr><th>ID</th><th>Name</th><th>Position</th><th>Department</th><th>Salary</th><th>Join Date</th><th>Email</th><th>Actions</th></tr></thead>
                <tbody id="employeeTable"></tbody>
            </table>
        </section>

        <!-- Payroll Section -->
        <section id="payroll" class="section d-none">
            <h2>Payroll Processing</h2>
            <form id="payrollForm">
                <div class="row mb-3">
                    <div class="col-md-4">
                        <select class="form-control" id="payEmpId">
                            <option value="">Select Employee</option>
                        </select>
                    </div>
                    <div class="col-md-4"><input type="number" class="form-control" placeholder="Base Salary" id="paySalary"></div>
                    <div class="col-md-4"><button type="button" class="btn btn-primary" onclick="calculatePayroll()">Calculate & Add</button></div>
                </div>
            </form>
            <table class="table mt-4">
                <thead><tr><th>Employee Name</th><th>Net Pay</th><th>Date</th><th>Actions</th></tr></thead>
                <tbody id="payrollTable"></tbody>
            </table>
        </section>

        <!-- Recruitment Section -->
        <section id="recruitment" class="section d-none">
            <h2>Recruitment Management</h2>
            <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#addJobModal">Add Job Posting</button>
            <table class="table table-striped">
                <thead><tr><th>ID</th><th>Title</th><th>Description</th><th>Status</th><th>Actions</th></tr></thead>
                <tbody id="jobTable"></tbody>
            </table>
        </section>

        <!-- Performance Section -->
        <section id="performance" class="section d-none">
            <h2>Performance Management</h2>
            <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#addReviewModal">Add Review</button>
            <table class="table table-striped">
                <thead><tr><th>Employee</th><th>Score</th><th>Comments</th><th>Date</th><th>Actions</th></tr></thead>
                <tbody id="performanceTable"></tbody>
            </table>
        </section>

        <!-- Attendance Section -->
        <section id="attendance" class="section d-none">
            <h2>Time & Attendance</h2>
            <div class="d-flex justify-content-between mb-3">
                <select class="form-control w-auto" id="attEmpId">
                    <option value="">Select Employee</option>
                </select>
                <button class="btn btn-success ms-2" onclick="clockIn()">Clock In</button>
                <button class="btn btn-warning ms-2" onclick="clockOut()">Clock Out</button>
            </div>
            <table class="table table-striped">
                <thead><tr><th>Employee</th><th>Date</th><th>In Time</th><th>Out Time</th><th>Hours</th></tr></thead>
                <tbody id="attendanceTable"></tbody>
            </table>
        </section>

        <!-- Leaves Section -->
        <section id="leaves" class="section d-none">
            <h2>Leave Management</h2>
            <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#addLeaveModal">Apply Leave</button>
            <table class="table table-striped">
                <thead><tr><th>Employee</th><th>Start Date</th><th>End Date</th><th>Reason</th><th>Status</th><th>Actions</th></tr></thead>
                <tbody id="leavesTable"></tbody>
            </table>
        </section>

        <!-- Benefits Section -->
        <section id="benefits" class="section d-none">
            <h2>Benefits Administration</h2>
            <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#addBenefitModal">Add Benefit</button>
            <table class="table table-striped">
                <thead><tr><th>ID</th><th>Name</th><th>Description</th><th>Actions</th></tr></thead>
                <tbody id="benefitsTable"></tbody>
            </table>
        </section>

        <!-- Training Section -->
        <section id="training" class="section d-none">
            <h2>Training & Development</h2>
            <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#addCourseModal">Add Course</button>
            <table class="table table-striped">
                <thead><tr><th>ID</th><th>Title</th><th>Description</th><th>Assigned To</th><th>Actions</th></tr></thead>
                <tbody id="trainingTable"></tbody>
            </table>
        </section>

        <!-- Reports Section -->
        <section id="reports" class="section d-none">
            <h2>Reporting & Analytics</h2>
            <div class="row">
                <div class="col-md-4"><button class="btn btn-info w-100 mb-3" onclick="generateEmployeeReport()">Employee Report</button></div>
                <div class="col-md-4"><button class="btn btn-info w-100 mb-3" onclick="generatePayrollReport()">Payroll Report</button></div>
                <div class="col-md-4"><button class="btn btn-info w-100 mb-3" onclick="generateAttendanceReport()">Attendance Report</button></div>
            </div>
            <div id="reportOutput" class="mt-4"></div>
        </section>

        <!-- Settings Section -->
        <section id="settings" class="section d-none">
            <h2>System Settings</h2>
            <form id="settingsForm">
                <div class="mb-3"><label>Company Name</label><input type="text" class="form-control" id="companyName" placeholder="Enter company name"></div>
                <div class="mb-3"><label>Tax Rate (%)</label><input type="number" class="form-control" id="taxRate" placeholder="Enter tax rate" value="15"></div>
                <div class="form-check mb-3">
                    <input type="checkbox" class="form-check-input" id="darkMode">
                    <label class="form-check-label" for="darkMode">Enable Dark Mode</label>
                </div>
                <button type="button" class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
            </form>
        </section>
    </div>

    <!-- Modals -->
    <!-- Add Employee Modal -->
    <div class="modal fade" id="addEmployeeModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header"><h5>Add New Employee</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <form id="employeeForm">
                        <input type="text" class="form-control mb-3" id="empName" placeholder="Name" required>
                        <input type="text" class="form-control mb-3" id="empPosition" placeholder="Position" required>
                        <input type="text" class="form-control mb-3" id="empDepartment" placeholder="Department" required>
                        <input type="number" class="form-control mb-3" id="empSalary" placeholder="Salary" required>
                        <input type="date" class="form-control mb-3" id="empJoinDate" required>
                        <input type="email" class="form-control mb-3" id="empEmail" placeholder="Email" required>
                    </form>
                </div>
                <div class="modal-footer"><button class="btn btn-primary" onclick="addEmployee()">Save</button></div>
            </div>
        </div>
    </div>

    <!-- Edit Employee Modal -->
    <div class="modal fade" id="editEmployeeModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header"><h5>Edit Employee</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <form id="editEmployeeForm">
                        <input type="hidden" id="editEmpIndex">
                        <input type="text" class="form-control mb-3" id="editEmpName" placeholder="Name" required>
                        <input type="text" class="form-control mb-3" id="editEmpPosition" placeholder="Position" required>
                        <input type="text" class="form-control mb-3" id="editEmpDepartment" placeholder="Department" required>
                        <input type="number" class="form-control mb-3" id="editEmpSalary" placeholder="Salary" required>
                        <input type="date" class="form-control mb-3" id="editEmpJoinDate" required>
                        <input type="email" class="form-control mb-3" id="editEmpEmail" placeholder="Email" required>
                    </form>
                </div>
                <div class="modal-footer"><button class="btn btn-primary" onclick="updateEmployee()">Update</button></div>
            </div>
        </div>
    </div>

    <!-- Add Job Modal -->
    <div class="modal fade" id="addJobModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header"><h5>Add Job Posting</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <input type="text" class="form-control mb-3" id="jobTitle" placeholder="Job Title" required>
                    <textarea class="form-control mb-3" id="jobDesc" placeholder="Description" required></textarea>
                    <select class="form-control" id="jobStatus">
                        <option value="Open">Open</option>
                        <option value="Closed">Closed</option>
                    </select>
                </div>
                <div class="modal-footer"><button class="btn btn-primary" onclick="addJob()">Save</button></div>
            </div>
        </div>
    </div>

    <!-- Add Review Modal -->
    <div class="modal fade" id="addReviewModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header"><h5>Add Performance Review</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <select class="form-control mb-3" id="reviewEmpId">
                        <option value="">Select Employee</option>
                    </select>
                    <input type="number" class="form-control mb-3" id="reviewScore" placeholder="Score (1-5)" min="1" max="5" required>
                    <textarea class="form-control mb-3" id="reviewComments" placeholder="Comments" required></textarea>
                </div>
                <div class="modal-footer"><button class="btn btn-primary" onclick="addReview()">Save</button></div>
            </div>
        </div>
    </div>

    <!-- Add Leave Modal -->
    <div class="modal fade" id="addLeaveModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header"><h5>Apply for Leave</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <select class="form-control mb-3" id="leaveEmpId">
                        <option value="">Select Employee</option>
                    </select>
                    <input type="date" class="form-control mb-3" id="leaveStart" required>
                    <input type="date" class="form-control mb-3" id="leaveEnd" required>
                    <textarea class="form-control mb-3" id="leaveReason" placeholder="Reason" required></textarea>
                </div>
                <div class="modal-footer"><button class="btn btn-primary" onclick="addLeave()">Save</button></div>
            </div>
        </div>
    </div>

    <!-- Add Benefit Modal -->
    <div class="modal fade" id="addBenefitModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header"><h5>Add Benefit</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <input type="text" class="form-control mb-3" id="benefitName" placeholder="Benefit Name" required>
                    <textarea class="form-control mb-3" id="benefitDesc" placeholder="Description" required></textarea>
                </div>
                <div class="modal-footer"><button class="btn btn-primary" onclick="addBenefit()">Save</button></div>
            </div>
        </div>
    </div>

    <!-- Add Course Modal -->
    <div class="modal fade" id="addCourseModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header"><h5>Add Training Course</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <input type="text" class="form-control mb-3" id="courseTitle" placeholder="Course Title" required>
                    <textarea class="form-control mb-3" id="courseDesc" placeholder="Description" required></textarea>
                    <select class="form-control mb-3" id="courseEmpId">
                        <option value="">Assign to Employee</option>
                    </select>
                </div>
                <div class="modal-footer"><button class="btn btn-primary" onclick="addCourse()">Save</button></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Data Storage
        let employees = JSON.parse(localStorage.getItem('employees')) || [];
        let payrolls = JSON.parse(localStorage.getItem('payrolls')) || [];
        let jobs = JSON.parse(localStorage.getItem('jobs')) || [];
        let reviews = JSON.parse(localStorage.getItem('reviews')) || [];
        let attendances = JSON.parse(localStorage.getItem('attendances')) || [];
        let leaves = JSON.parse(localStorage.getItem('leaves')) || [];
        let benefits = JSON.parse(localStorage.getItem('benefits')) || [];
        let courses = JSON.parse(localStorage.getItem('courses')) || [];
        let settings = JSON.parse(localStorage.getItem('settings')) || { companyName: 'My Company', taxRate: 15, darkMode: false };

        // Sidebar Toggle
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const content = document.querySelector('.content');
            const toggleBtn = document.querySelector('.btn-toggle-sidebar');
            sidebar.classList.toggle('collapsed');
            content.classList.toggle('expanded');
            toggleBtn.classList.toggle('expanded');
        }

        // Apply Theme
        function applyTheme() {
            if (settings.darkMode) {
                document.body.classList.add('dark-mode');
                dashboardChart.data.datasets[0].borderColor = '#4da6ff';
            } else {
                document.body.classList.remove('dark-mode');
                dashboardChart.data.datasets[0].borderColor = '#0d6efd';
            }
            dashboardChart.update();
        }

        // Show Section
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(sec => sec.classList.add('d-none'));
            document.getElementById(sectionId).classList.remove('d-none');
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            document.querySelector(`a[href="#${sectionId}"]`).classList.add('active');
            if (sectionId === 'dashboard') updateDashboard();
            else if (sectionId === 'employees') renderEmployees();
            else if (sectionId === 'payroll') { renderPayrolls(); populateEmployeeSelect('payEmpId'); }
            else if (sectionId === 'recruitment') renderJobs();
            else if (sectionId === 'performance') { renderReviews(); populateEmployeeSelect('reviewEmpId'); }
            else if (sectionId === 'attendance') { renderAttendances(); populateEmployeeSelect('attEmpId'); }
            else if (sectionId === 'leaves') { renderLeaves(); populateEmployeeSelect('leaveEmpId'); }
            else if (sectionId === 'benefits') renderBenefits();
            else if (sectionId === 'training') { renderCourses(); populateEmployeeSelect('courseEmpId'); }
            else if (sectionId === 'settings') renderSettings();
        }

        // Populate Employee Select
        function populateEmployeeSelect(selectId) {
            const select = document.getElementById(selectId);
            select.innerHTML = '<option value="">Select Employee</option>';
            employees.forEach((emp, index) => {
                select.innerHTML += `<option value="${index}">${emp.name} (${emp.position})</option>`;
            });
        }

        // Employees Functions
        function renderEmployees(search = '') {
            const table = document.getElementById('employeeTable');
            table.innerHTML = '';
            employees.filter(emp => emp.name.toLowerCase().includes(search.toLowerCase())).forEach((emp, index) => {
                table.innerHTML += `<tr><td>${index + 1}</td><td>${emp.name}</td><td>${emp.position}</td><td>${emp.department}</td><td>${emp.salary}</td><td>${emp.joinDate}</td><td>${emp.email}</td><td><button class="btn btn-sm btn-warning me-1" onclick="editEmployee(${index})">Edit</button><button class="btn btn-sm btn-danger" onclick="deleteEmployee(${index})">Delete</button></td></tr>`;
            });
        }
        function searchEmployees() {
            const search = document.getElementById('employeeSearch').value;
            renderEmployees(search);
        }
        function addEmployee() {
            const name = document.getElementById('empName').value;
            const position = document.getElementById('empPosition').value;
            const department = document.getElementById('empDepartment').value;
            const salary = parseFloat(document.getElementById('empSalary').value);
            const joinDate = document.getElementById('empJoinDate').value;
            const email = document.getElementById('empEmail').value;
            if (name && position && department && salary && joinDate && email) {
                employees.push({ name, position, department, salary, joinDate, email });
                localStorage.setItem('employees', JSON.stringify(employees));
                renderEmployees();
                bootstrap.Modal.getInstance(document.getElementById('addEmployeeModal')).hide();
                updateDashboard();
            }
        }
        function editEmployee(index) {
            document.getElementById('editEmpIndex').value = index;
            document.getElementById('editEmpName').value = employees[index].name;
            document.getElementById('editEmpPosition').value = employees[index].position;
            document.getElementById('editEmpDepartment').value = employees[index].department;
            document.getElementById('editEmpSalary').value = employees[index].salary;
            document.getElementById('editEmpJoinDate').value = employees[index].joinDate;
            document.getElementById('editEmpEmail').value = employees[index].email;
            new bootstrap.Modal(document.getElementById('editEmployeeModal')).show();
        }
        function updateEmployee() {
            const index = document.getElementById('editEmpIndex').value;
            const name = document.getElementById('editEmpName').value;
            const position = document.getElementById('editEmpPosition').value;
            const department = document.getElementById('editEmpDepartment').value;
            const salary = parseFloat(document.getElementById('editEmpSalary').value);
            const joinDate = document.getElementById('editEmpJoinDate').value;
            const email = document.getElementById('editEmpEmail').value;
            if (name && position && department && salary && joinDate && email) {
                employees[index] = { name, position, department, salary, joinDate, email };
                localStorage.setItem('employees', JSON.stringify(employees));
                renderEmployees();
                bootstrap.Modal.getInstance(document.getElementById('editEmployeeModal')).hide();
                updateDashboard();
            }
        }
        function deleteEmployee(index) {
            if (confirm('Are you sure?')) {
                employees.splice(index, 1);
                localStorage.setItem('employees', JSON.stringify(employees));
                renderEmployees();
                updateDashboard();
            }
        }

        // Payroll Functions
        function calculatePayroll() {
            const empIndex = document.getElementById('payEmpId').value;
            const salary = parseFloat(document.getElementById('paySalary').value);
            if (empIndex !== '' && salary) {
                const taxRate = settings.taxRate / 100;
                const netPay = salary * (1 - taxRate);
                payrolls.push({ empIndex, netPay, date: new Date().toLocaleDateString() });
                localStorage.setItem('payrolls', JSON.stringify(payrolls));
                renderPayrolls();
            }
        }
        function renderPayrolls() {
            const table = document.getElementById('payrollTable');
            table.innerHTML = '';
            payrolls.forEach((pay, index) => {
                const emp = employees[pay.empIndex] || { name: 'Deleted Employee' };
                table.innerHTML += `<tr><td>${emp.name}</td><td>${pay.netPay.toFixed(2)}</td><td>${pay.date}</td><td><button class="btn btn-sm btn-danger" onclick="deletePayroll(${index})">Delete</button></td></tr>`;
            });
        }
        function deletePayroll(index) {
            if (confirm('Are you sure?')) {
                payrolls.splice(index, 1);
                localStorage.setItem('payrolls', JSON.stringify(payrolls));
                renderPayrolls();
            }
        }

        // Recruitment Functions
        function addJob() {
            const title = document.getElementById('jobTitle').value;
            const desc = document.getElementById('jobDesc').value;
            const status = document.getElementById('jobStatus').value;
            if (title && desc) {
                jobs.push({ title, desc, status });
                localStorage.setItem('jobs', JSON.stringify(jobs));
                renderJobs();
                bootstrap.Modal.getInstance(document.getElementById('addJobModal')).hide();
                updateDashboard();
            }
        }
        function renderJobs() {
            const table = document.getElementById('jobTable');
            table.innerHTML = '';
            jobs.forEach((job, index) => {
                table.innerHTML += `<tr><td>${index + 1}</td><td>${job.title}</td><td>${job.desc}</td><td>${job.status}</td><td><button class="btn btn-sm btn-danger" onclick="deleteJob(${index})">Delete</button></td></tr>`;
            });
            document.getElementById('openPositions').textContent = jobs.filter(j => j.status === 'Open').length;
        }
        function deleteJob(index) {
            if (confirm('Are you sure?')) {
                jobs.splice(index, 1);
                localStorage.setItem('jobs', JSON.stringify(jobs));
                renderJobs();
                updateDashboard();
            }
        }

        // Performance Functions
        function addReview() {
            const empIndex = document.getElementById('reviewEmpId').value;
            const score = parseInt(document.getElementById('reviewScore').value);
            const comments = document.getElementById('reviewComments').value;
            if (empIndex !== '' && score && comments) {
                reviews.push({ empIndex, score, comments, date: new Date().toLocaleDateString() });
                localStorage.setItem('reviews', JSON.stringify(reviews));
                renderReviews();
                bootstrap.Modal.getInstance(document.getElementById('addReviewModal')).hide();
                updateDashboard();
            }
        }
        function renderReviews() {
            const table = document.getElementById('performanceTable');
            table.innerHTML = '';
            reviews.forEach((rev, index) => {
                const emp = employees[rev.empIndex] || { name: 'Deleted Employee' };
                table.innerHTML += `<tr><td>${emp.name}</td><td>${rev.score}</td><td>${rev.comments}</td><td>${rev.date}</td><td><button class="btn btn-sm btn-danger" onclick="deleteReview(${index})">Delete</button></td></tr>`;
            });
        }
        function deleteReview(index) {
            if (confirm('Are you sure?')) {
                reviews.splice(index, 1);
                localStorage.setItem('reviews', JSON.stringify(reviews));
                renderReviews();
                updateDashboard();
            }
        }

        // Attendance Functions
        function clockIn() {
            const empIndex = document.getElementById('attEmpId').value;
            if (empIndex !== '') {
                const now = new Date();
                attendances.push({ empIndex, date: now.toLocaleDateString(), inTime: now.toLocaleTimeString(), outTime: null, hours: 0 });
                localStorage.setItem('attendances', JSON.stringify(attendances));
                renderAttendances();
            }
        }
        function clockOut() {
            const empIndex = document.getElementById('attEmpId').value;
            if (empIndex !== '') {
                const today = new Date().toLocaleDateString();
                const att = attendances.find(a => a.empIndex == empIndex && a.date === today && !a.outTime);
                if (att) {
                    const outTime = new Date();
                    att.outTime = outTime.toLocaleTimeString();
                    const inDate = new Date(`${att.date} ${att.inTime}`);
                    att.hours = ((outTime - inDate) / 3600000).toFixed(2);
                    localStorage.setItem('attendances', JSON.stringify(attendances));
                    renderAttendances();
                } else {
                    alert('No clock-in found for today.');
                }
            }
        }
        function renderAttendances() {
            const table = document.getElementById('attendanceTable');
            table.innerHTML = '';
            attendances.forEach(att => {
                const emp = employees[att.empIndex] || { name: 'Deleted Employee' };
                table.innerHTML += `<tr><td>${emp.name}</td><td>${att.date}</td><td>${att.inTime}</td><td>${att.outTime || 'Pending'}</td><td>${att.hours}</td></tr>`;
            });
        }

        // Leaves Functions
        function addLeave() {
            const empIndex = document.getElementById('leaveEmpId').value;
            const start = document.getElementById('leaveStart').value;
            const end = document.getElementById('leaveEnd').value;
            const reason = document.getElementById('leaveReason').value;
            if (empIndex !== '' && start && end && reason) {
                leaves.push({ empIndex, start, end, reason, status: 'Pending' });
                localStorage.setItem('leaves', JSON.stringify(leaves));
                renderLeaves();
                bootstrap.Modal.getInstance(document.getElementById('addLeaveModal')).hide();
                updateDashboard();
            }
        }
        function renderLeaves() {
            const table = document.getElementById('leavesTable');
            table.innerHTML = '';
            leaves.forEach((leave, index) => {
                const emp = employees[leave.empIndex] || { name: 'Deleted Employee' };
                const disabled = leave.status !== 'Pending' ? 'disabled' : '';
                table.innerHTML += `<tr><td>${emp.name}</td><td>${leave.start}</td><td>${leave.end}</td><td>${leave.reason}</td><td>${leave.status}</td><td><button class="btn btn-sm btn-success me-1" onclick="approveLeave(${index})" ${disabled}>Approve</button><button class="btn btn-sm btn-danger me-1" onclick="rejectLeave(${index})" ${disabled}>Reject</button><button class="btn btn-sm btn-danger" onclick="deleteLeave(${index})">Delete</button></td></tr>`;
            });
        }
        function approveLeave(index) {
            leaves[index].status = 'Approved';
            localStorage.setItem('leaves', JSON.stringify(leaves));
            renderLeaves();
            updateDashboard();
        }
        function rejectLeave(index) {
            leaves[index].status = 'Rejected';
            localStorage.setItem('leaves', JSON.stringify(leaves));
            renderLeaves();
            updateDashboard();
        }
        function deleteLeave(index) {
            if (confirm('Are you sure?')) {
                leaves.splice(index, 1);
                localStorage.setItem('leaves', JSON.stringify(leaves));
                renderLeaves();
                updateDashboard();
            }
        }

        // Benefits Functions
        function addBenefit() {
            const name = document.getElementById('benefitName').value;
            const desc = document.getElementById('benefitDesc').value;
            if (name && desc) {
                benefits.push({ name, desc });
                localStorage.setItem('benefits', JSON.stringify(benefits));
                renderBenefits();
                bootstrap.Modal.getInstance(document.getElementById('addBenefitModal')).hide();
            }
        }
        function renderBenefits() {
            const table = document.getElementById('benefitsTable');
            table.innerHTML = '';
            benefits.forEach((ben, index) => {
                table.innerHTML += `<tr><td>${index + 1}</td><td>${ben.name}</td><td>${ben.desc}</td><td><button class="btn btn-sm btn-danger" onclick="deleteBenefit(${index})">Delete</button></td></tr>`;
            });
        }
        function deleteBenefit(index) {
            if (confirm('Are you sure?')) {
                benefits.splice(index, 1);
                localStorage.setItem('benefits', JSON.stringify(benefits));
                renderBenefits();
            }
        }

        // Training Functions
        function addCourse() {
            const title = document.getElementById('courseTitle').value;
            const desc = document.getElementById('courseDesc').value;
            const empIndex = document.getElementById('courseEmpId').value;
            if (title && desc) {
                courses.push({ title, desc, empIndex });
                localStorage.setItem('courses', JSON.stringify(courses));
                renderCourses();
                bootstrap.Modal.getInstance(document.getElementById('addCourseModal')).hide();
            }
        }
        function renderCourses() {
            const table = document.getElementById('trainingTable');
            table.innerHTML = '';
            courses.forEach((course, index) => {
                const emp = employees[course.empIndex] || { name: 'Unassigned' };
                table.innerHTML += `<tr><td>${index + 1}</td><td>${course.title}</td><td>${course.desc}</td><td>${emp.name}</td><td><button class="btn btn-sm btn-danger" onclick="deleteCourse(${index})">Delete</button></td></tr>`;
            });
        }
        function deleteCourse(index) {
            if (confirm('Are you sure?')) {
                courses.splice(index, 1);
                localStorage.setItem('courses', JSON.stringify(courses));
                renderCourses();
            }
        }

        // Reports Functions
        function generateEmployeeReport() {
            let output = '<h4>Employee Report</h4><table class="table"><thead><tr><th>Name</th><th>Position</th><th>Department</th><th>Salary</th><th>Join Date</th><th>Email</th></tr></thead><tbody>';
            employees.forEach(emp => {
                output += `<tr><td>${emp.name}</td><td>${emp.position}</td><td>${emp.department}</td><td>${emp.salary}</td><td>${emp.joinDate}</td><td>${emp.email}</td></tr>`;
            });
            output += '</tbody></table>';
            document.getElementById('reportOutput').innerHTML = output;
        }
        function generatePayrollReport() {
            let output = '<h4>Payroll Report</h4><table class="table"><thead><tr><th>Employee</th><th>Net Pay</th><th>Date</th></tr></thead><tbody>';
            payrolls.forEach(pay => {
                const emp = employees[pay.empIndex] || { name: 'Deleted' };
                output += `<tr><td>${emp.name}</td><td>${pay.netPay.toFixed(2)}</td><td>${pay.date}</td></tr>`;
            });
            output += '</tbody></table>';
            document.getElementById('reportOutput').innerHTML = output;
        }
        function generateAttendanceReport() {
            let output = '<h4>Attendance Report</h4><table class="table"><thead><tr><th>Employee</th><th>Date</th><th>Hours</th></tr></thead><tbody>';
            attendances.forEach(att => {
                const emp = employees[att.empIndex] || { name: 'Deleted' };
                output += `<tr><td>${emp.name}</td><td>${att.date}</td><td>${att.hours}</td></tr>`;
            });
            output += '</tbody></table>';
            document.getElementById('reportOutput').innerHTML = output;
        }

        // Settings Functions
        function renderSettings() {
            document.getElementById('companyName').value = settings.companyName;
            document.getElementById('taxRate').value = settings.taxRate;
            document.getElementById('darkMode').checked = settings.darkMode;
        }
        function saveSettings() {
            settings.companyName = document.getElementById('companyName').value;
            settings.taxRate = parseFloat(document.getElementById('taxRate').value);
            settings.darkMode = document.getElementById('darkMode').checked;
            localStorage.setItem('settings', JSON.stringify(settings));
            applyTheme();
            alert('Settings saved!');
        }

        // Dashboard Functions
        function updateDashboard() {
            document.getElementById('totalEmployees').textContent = employees.length;
            document.getElementById('openPositions').textContent = jobs.filter(j => j.status === 'Open').length;
            const avgScore = reviews.length > 0 ? (reviews.reduce((sum, rev) => sum + rev.score, 0) / reviews.length).toFixed(1) : 0;
            document.getElementById('avgPerformance').textContent = `${avgScore}/5`;
            document.getElementById('pendingLeaves').textContent = leaves.filter(l => l.status === 'Pending').length;

            // Update Chart with New Employees per Month
            const now = new Date();
            const labels = [];
            const data = [];
            for (let i = 5; i >= 0; i--) {
                const date = new Date(now.getFullYear(), now.getMonth() - i, 1);
                labels.push(date.toLocaleString('default', { month: 'short' }));
                const nextMonth = new Date(date.getFullYear(), date.getMonth() + 1, 1);
                const count = employees.filter(emp => {
                    if (!emp.joinDate) return false;
                    const jd = new Date(emp.joinDate);
                    return jd >= date && jd < nextMonth;
                }).length;
                data.push(count);
            }
            dashboardChart.data.labels = labels;
            dashboardChart.data.datasets[0].data = data;
            dashboardChart.data.datasets[0].label = 'New Employees';
            dashboardChart.update();
        }
        const ctx = document.getElementById('dashboardChart').getContext('2d');
        const dashboardChart = new Chart(ctx, {
            type: 'line',
            data: { labels: [], datasets: [{ label: 'New Employees', data: [], borderColor: '#0d6efd', fill: false }] },
            options: { scales: { y: { beginAtZero: true } }, responsive: true }
        });

        // Logout
        function logout() {
            if (confirm('Logout?')) {
                localStorage.clear();
                location.reload();
            }
        }

        // Initial Load
        applyTheme();
        document.getElementById('payEmpId').addEventListener('change', (e) => {
            const index = e.target.value;
            if (index !== '') {
                document.getElementById('paySalary').value = employees[index].salary || '';
            }
        });
        renderEmployees();
        renderPayrolls();
        renderJobs();
        renderReviews();
        renderAttendances();
        renderLeaves();
        renderBenefits();
        renderCourses();
        updateDashboard();
        showSection('dashboard');
    </script>
</body>
</html>
